h1 Lobby

div#gamesView
  form(id="newGameForm", action="/game", method="post")
    input(id="new-game", class="xlarge", placeholder="Create new game", type="text", name="gameName")
  table#gamesTable.zebra-striped
    thead
      tr
        th Game Name
        th Players
        th # of Players
    tbody#gamesList

//ICanHaz Templates
script(id="game", type="text/html")
  td.gameName {{gameName}}
  td.gamePlayers {{#fbIds}}<img src="http://graph.facebook.com/{{.}}/picture">{{/fbIds}}
  td.gameNumPlayers {{numPlayers}}/4

//bootstrap collection
script
  $(document).ready(function() {
  
  $.get('/games', function(data) {
       App.gamesView.addAll(data);
  });
  //$("#gamesTable").tablesorter();
  
  var pusher = new Pusher('f6cbbef2da8723374cb3');
  var channel = pusher.subscribe('gameList');
  channel.bind('incrementEvent', function(conditions) {
    console.log("increment event");
    console.log(conditions);
    var gameId = conditions.id;
    var gameModel = App.games.get(gameId);
    console.log(gameModel);
    if (gameModel) {
       var currentPlayers = gameModel.get("numPlayers");
       gameModel.set({fbIds: conditions.fbIds});
       gameModel.set({numPlayers: currentPlayers+1});
    } else {
      var gameModel = new Game(conditions);
      App.games.add(gameModel);
      App.gamesView.addOne(gameModel);
    }
    });
    channel.bind('markInactiveEvent', function(conditions) {
      var gameModel = App.games.get(conditions._id);
      if (gameModel) {
         App.gamesView.remove(gameModel);
      }
    });
    // channel.bind('newGameEvent', function(conditions) {
    //   console.log("new game event");
    //   var gameModel = new Game(conditions);
    //   App.gamesView.addOne(gameModel);
    // });
    });
